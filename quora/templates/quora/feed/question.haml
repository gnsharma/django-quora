{% extends 'quora/common/base.haml' %}

{% block content %}

{% include 'quora/feed/navbar.haml' %}

.row
  .col.s9
    .section
      %h5 {{ question.question_text }}
    .divider
    .section.center
      %i.material-icons person
      %p
        %strong {{request.user.username|capfirst}}, can you answer this question?
      %p People are searching for a better answer to this question
      %a.btn.indigo.blue-text.lighten-5{:href => "{% url 'quora:answer' question.id %}" } 
        %i.material-icons create
        Answer
    %h6 
      %strong {{ question.answer_set.all.count }} Answer{{question.answer_set.all.count|pluralize}}
    .divider
    {% for answer in question.answer_set.all %}
    .section
      %h5 
        %i.material-icons person 
        {{answer.user.username}}
      %p
        {{ answer.answer_text }}
      %a.btn.small.indigo.lighten-5.blue-text{:id => "upvote_{{ answer.id }}" } Upvote | {{ answer.votes }}
      %a.btn-flat.grey-text.lighten-2{:id => "downvote_{{ answer.id }}"} Downvote
    .divider
    {% endfor %} 

{% endblock %}

{% block script %}

%script
  $(document).ready(function() {
    $("a[id^='upvote_']").click(function() {
      
      var id = parseInt(this.id.replace("upvote_", ""), 10);
      var vote_type = 'up';
      
      $.ajax( { 
        type: 'POST', 
        url: '/vote/answer/', 
        data: { 'csrfmiddlewaretoken': csrftoken, id: id, type: vote_type}, 
        success: function(response) {
          if (Number.isInteger(parseInt(response))) {
            $("a#upvote_" + id).text('Upvote | ' + response);
            Materialize.toast('Answer upvoted', 2000);
          }
        } 
      });
      return false;
    });
  });  
  
  $(document).ready(function() {
    $("a[id^='downvote_']").click(function() {
          
      var id = parseInt(this.id.replace("downvote_", ""), 10);
      var vote_type = 'down';
        
      $.ajax( {
        type: 'POST',
        url: '/vote/answer/', 
        data: { 'csrfmiddlewaretoken': csrftoken, id: id, type: vote_type}, 
        success: function(response) {
          if (Number.isInteger(parseInt(response))) {
            $("a#upvote_" + id).text('Upvote | ' + response);
            Materialize.toast('Answer downvoted', 2000);
          }
        }
      });
    });
  });  

{% endblock %}
